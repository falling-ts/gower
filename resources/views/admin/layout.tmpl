{{define "admin/head"}}
{{template "head" .}}
<div class="w-full h-full layout bg-no-repeat bg-cover relative">
  <img src="/public/static/images/admin-bg.jpg" alt="" class="absolute opacity-10 w-full h-full">
  <ul class="menu p-2 w-56 absolute top-[4.5rem] left-1 bottom-1 z-10 rounded-box ring-1 hidden lg:block animate__animated">
    {{range .admin_menus}}
    <li>
      {{if .children}}
      <details open>
        <summary>
          <a class="flex items-center" id="menu-{{.id}}" data-id="{{.id}}" {{with .path}}data-href="{{.}}"{{end}}>
            {{with .icon}}
            <i class="icon-[{{.}}] text-lg" role="img" aria-hidden="true"></i>
            {{else}}
            <i class="icon-[svg-spinners--wind-toy] text-lg" role="img" aria-hidden="true"></i>
            {{end}}
            <span class="ml-2">{{.name}}</span>
          </a>
        </summary>
        <ul>
          {{range (assertAnySlice .children)}}
          <li>
            <a class="flex items-center" id="menu-{{.id}}" data-id="{{.id}}" {{with .path}}data-href="{{.}}"{{end}}>
              {{with .icon}}
              <i class="icon-[{{.}}] text-lg" role="img" aria-hidden="true"></i>
              {{else}}
              <i class="icon-[svg-spinners--wind-toy] text-lg" role="img" aria-hidden="true"></i>
              {{end}}
              {{.name}}
            </a>
          </li>
          {{end}}
        </ul>
      </details>
      {{else}}
      <a class="flex items-center" id="menu-{{.id}}" data-id="{{.id}}" {{with .path}}data-href="{{.}}"{{end}}>
        {{with .icon}}
        <i class="icon-[{{.}}] text-lg" role="img" aria-hidden="true"></i>
        {{else}}
        <i class="icon-[svg-spinners--wind-toy] text-lg" role="img" aria-hidden="true"></i>
        {{end}}
        {{.name}}
      </a>
      {{end}}
    </li>
    {{end}}
  </ul>
  <div class="content py-2 absolute top-[4.5rem] right-1 bottom-1 lg:left-[14.35rem] left-1 rounded-md ring-1 animate__animated animate__headShake"
       data-simplebar>
    <div class="text-sm breadcrumbs px-4">
      {{with .breadcrumbs}}
      <ul>
        {{range .}}
        <li>
          <a href="{{.path}}">{{.name}}</a>
        </li>
        {{end}}
      </ul>
      {{else}}
      <ul>
        <li>
          <a href="/admin">主页</a>
        </li>
      </ul>
      {{end}}
    </div>
    {{end}}

    {{define "admin/foot"}}
    <footer class="footer footer-center py-4 mt-4 bg-base-300 text-base-content absolute bottom-0">
      <div>
        <p>Copyright © 2023 - All right reserved by Gower</p>
      </div>
    </footer>
  </div>
  <div class="navbar w-auto absolute top-1 inset-x-1 rounded-md ring-1 animate__animated">
    <div class="flex-none">
      <button class="btn btn-square btn-ghost menu-ctrl">
        <i class="icon-[svg-spinners--blocks-wave] text-xl" role="img" aria-hidden="true"></i>
      </button>
    </div>

    <div class="flex-1">
      <a href="/admin" class="btn btn-ghost normal-case text-xl">Gower Admin</a>
    </div>

    <div class="flex-none gap-2">
      <button class="btn btn-ghost btn-circle">
          <span class="indicator">
            <i class="icon-[line-md--bell-twotone-loop] text-xl" role="img" aria-hidden="true"></i>
            <span class="badge badge-xs badge-secondary indicator-item">5</span>
          </span>
      </button>
      <div class="dropdown dropdown-end">
        <label tabindex="0" class="btn btn-ghost btn-circle avatar">
            <span class="w-10 rounded-full">
              <img src="/public/static/images/avatar.png"  alt=""/>
            </span>
        </label>
        <ul tabindex="0" class="mt-3 p-2 shadow menu menu-compact dropdown-content bg-base-100 rounded-box w-52">
          <li>
            <a>个人主页</a>
          </li>
          <li>
            <a>设置</a>
          </li>
          <li>
            <a class="logout">退出</a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>
{{template "foot" .}}
<script type="module">
  import { $, util, msg, api, cookie } from "/public/static/main.js"
  const { admin } = api

  $(() => {
    const id = localStorage.getItem("menu-active")

    if (id) {
      $(`#menu-${id}`)
        .addClass("active")
        .parents("ul")
        .siblings("a")
        .addClass("active")
    } else {
      $(`#menu-1`).addClass("active")
    }

  })

  $(".logout").on("click", () => {
    msg.confirm("是否退出", async () => {
      const res = await admin.logout()
      if (!res.code) {
        msg.success(res.msg)
        setTimeout(() => {
          cookie.remove("admin-token")
          window.location.href = "/admin"
        }, 2000)
      }
    })
  })

  $(".menu a").on("click", function () {
    const elem = $(this),
      id = elem.data("id"),
      href = elem.data("href")

    localStorage.setItem("menu-active", id)
    if (href) {
      window.location.href = href
    }
  })

</script>
{{end}}
